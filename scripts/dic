#!/bin/bash
WORD=${1%%.*}
WORD=${WORD##*/}
  clear && \
  echo "## $WORD ##" && \
  curl -s -A 'Mozilla/4.0' https://dic.daum.net/search.do?q=$WORD | \
  html2text -utf8 -nobs -style compact -width 500 | \
  awk '/단어장_저장/,/영영사전_더보기/{if( /^[a-z/]+/ || /^\s+\*/ && !/\|$/) print $0}' | \
  awk '{sub(/단어장_저장 완료/,""); sub(/영영사전_더보기/,""); print $0}' | \
  awk '{if(!/^o\s+/ && !/공지사항$/) print $0}' | \
  awk 'NR<10 {print $0} END{printf "===========\n"}'

mp3_audios=~/Project/dic/mp3/*.mp3
get_audio=~/Project/dic/mp3/${WORD}.mp3

if [ -f ${get_audio} ]; then
  for i in {1..15}; do mpv ${get_audio} > /dev/null 2>&1; sleep 3; done

  for i in ${mp3_audios} 
    do
      w=${i##*/}
      w=${w%%.*}
      clear && \
      echo "===== $w =====" && \
      curl -s -A 'Mozilla/4.0' https://dic.daum.net/search.do?q=$w | \
      html2text -utf8 -nobs -style compact -width 500 | \
      awk '/단어장_저장/,/영영사전_더보기/{if( /^[a-z/]+/ || /^\s+\*/ && !/\|$/) print $0}' | \
      awk '{sub(/단어장_저장 완료/,""); sub(/영영사전_더보기/,""); print $0}' | \
      awk '{if(!/^o\s+/ && !/공지사항$/) print $0}' | \
      awk 'NR<10{print $0}END{printf "===========\n"}'
  
      mpv "${i}" > /dev/null 2>&1
      sleep 3
      mpv "${i}" > /dev/null 2>&1
    done

else
  curl -s -A 'Mozilla/4.0' https://dic.daum.net/search.do?q="${WORD}" | \
  awk -F "\"" '/txt_pronounce/{print $4;exit}' | \
  xargs -I{} curl -o ~/Project/dic/mp3/${WORD}.mp3 {} && \
  for i in {1..15}; do mpv ${get_audio} > /dev/null 2>&1; sleep 3; done
fi
